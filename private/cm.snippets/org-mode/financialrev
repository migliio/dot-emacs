# -*- mode: snippet -*- 
# name: financial review
# key: finrev
# --

#+begin_src bash :results none
bean-query -f csv ~/.beancount \'select date, number, account where account ~ \"Expenses:\" \' > /tmp/gnuplot_expenses.csv
grep $1 /tmp/gnuplot_expenses.csv > /tmp/gnuplot_tmp.csv
mv /tmp/gnuplot_tmp.csv /tmp/gnuplot_expenses.csv
awk -F \',\' \'{ category[\$3] += \$2 } END { for (c in category) print c \",\" category[c] }\' /tmp/gnuplot_expenses.csv > /tmp/gnuplot_expenses_processed.csv
awk -F \"Expenses:\" -v OFS=\"\"  '{if (NF>1) \$1=\"\"; print \$0}\' /tmp/gnuplot_expenses_processed.csv > /tmp/gnuplot_expenses_processed_final.csv
mv /tmp/gnuplot_expenses_processed_final.csv /tmp/gnuplot_expenses_processed.csv
#+end_src

#+begin_src gnuplot
reset

set datafile separator ','

set border lc rgb "#586e75"
set grid lc rgb "#586e75"
set title textcolor rgb "#586e75"
set xlabel textcolor rgb "#586e75"
set ylabel textcolor rgb "#586e75"
set xtics textcolor rgb "#586e75"
set ytics textcolor rgb "#586e75"
set key textcolor rgb "#586e75"

set xtics rotate by -65 font "Arial,10" textcolor rgb "#586e75"

set xlabel "Category"
set ylabel "Amount"
set title "Global Expenses by Category"

set boxwidth 0.5

set linetype 1 lw 2 lc rgb '#268bd2' ps 1 pt 9
set style fill solid 0.5 border rgb "#268bd2"

plot "/tmp/gnuplot_expenses_processed.csv" using 2:xtic(1) with boxes lt 1 title "Expenses per category"
#+end_src